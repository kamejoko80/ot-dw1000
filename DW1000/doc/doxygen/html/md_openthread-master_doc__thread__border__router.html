<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OT-DW1000: Thread Bourder Router with Raspberry Pi and DW1000</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Open-Thread-Logo-200x42.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OT-DW1000
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Thread Bourder Router with Raspberry Pi and DW1000 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction:</h2>
<p>Nordic semiconductors Developed an Example(Thread Border Router), i.e., Raspberry Pi as a Border Router connected with NCP node and to the Internet (Ethernet or Wi-Fi). Thread Border Router serves as a gateway between the Internet and the Thread network. This example is tested for nordic radio and also for decawave radio.</p>
<h2>Required hardware :</h2>
<ul>
<li>Raspberry Pi 3 B</li>
<li>nRF52840 Development Kit</li>
<li>1 GB (or larger) microSD card with SD card adapter</li>
<li>microUSB power supply for Raspberry Pi 3 B</li>
<li>microUSB to USB cable for connecting the nRF52840 Development Kit to the Raspberry Pi</li>
<li>Computer running the Linux operating system with SD card slot or SD/microSD USB adapter.</li>
</ul>
<h2>Required software:</h2>
<ul>
<li>Terminal client with serial connection support, such as PuTTy/Tera term/ Minicom /Pyterm</li>
<li>Border Router Raspberry Pi image available from <a href="https://www.nordicsemi.com/eng/Products/nRF5-SDK-for-Thread/">nRF5 SDK for Thread</a> in <code>downloads</code> section as <code>RaspPi_Thread_Border_Router_Demo_v0.9.0-1.alpha.img</code></li>
<li>NCP firmware binary – arm-none-eabi-ot-ncp.hex</li>
<li>CLI firmware binary – arm-none-eabi-ot-cli-ftd.hex</li>
</ul>
<h2>Setup procedure:</h2>
<p>Complete the following steps to set up the Border Router solution:</p>
<p>1.Flashing the Raspberry Pi image to the microSD card</p><ul>
<li>Download the Raspbian image for thread from the direct link <a href="https://www.nordicsemi.com/eng/nordic/download_resource/60502/12/57596032/118100">Rasbian_Image</a></li>
<li>Extract the package for Image file.</li>
<li>Insert the SD Card into the SD card adapter and plug the adapter into ubuntu PC.</li>
<li>Go to the command prompt and check the name given to sd card by using command <div class="fragment"><div class="line">sudo fdisk -l</div></div><!-- fragment --> it may be <code>/dev/sdb</code> or <code>/dev/sdc</code> or <code>/dev/sdd</code> (varies from PC to PC)</li>
<li>Use the following command to copy the image on to the Raspberry Pi. <div class="fragment"><div class="line">sudo dd if=&lt;PATH to image&gt;/2017-04-10-raspbian-jessie.img of=/dev/sdc bs=4M</div></div><!-- fragment --> ex: <div class="fragment"><div class="line">sudo dd if=~/Downloads/2017-04-10-raspbian-jessie.img of=/dev/sdc bs=4M</div><div class="line">sudo sync</div></div><!-- fragment --></li>
<li>Eject the SD card safely.</li>
</ul>
<ol type="1">
<li>Insert the SD card into Raspberry Pi.</li>
<li>Flash the NCP binary on to the Nordic Board connected with EVB1000</li>
</ol>
<h2>Starting the Border Router:</h2>
<ol type="1">
<li>Connect the NCP Node to the Raspberry Pi using micro USB CABLE as shown in the below set up figure.</li>
<li>Connect the Raspberry Pi through an Ethernet cable to your switch/router that provides IPv4 or IPv6 connectivity with the DHCP or DHCPv6 service respectively</li>
<li>Connect the microUSB power supply to the Raspberry Pi. The Border Router will start booting.</li>
</ol>
<h3>SetUp Details of NCP Node with Raspberry pi Platform</h3>
<p>The setup image can found in DW1000/doc/images/thread_border_setup.png</p>
<h2>Thread Settings:</h2>
<p>The following are the default settings of the Border Router: </p><div class="fragment"><div class="line">Radio Channel: 11</div><div class="line">PAN ID: 0xABCD</div><div class="line">Network Master Key: 0x00112233445566778899AABBCCDDEEFF</div><div class="line">Mesh-Local Prefix: FDDE:AD00:BEEF::/64</div><div class="line">NAT64 Prefix: FD00:64:123:4567::/96</div></div><!-- fragment --><p> To customize the Thread settings, you must Log into the Border Router using SSH. To Log into Raspberry Pi using SSH, requires it's Ipv4 address. To find the IP address of Pi , use the <code>nmap</code> command on Ubuntu.</p><ol type="1">
<li>Install the <code>nmap</code> command using <div class="fragment"><div class="line">sudo apt-get install nmap</div></div><!-- fragment --></li>
<li>This method also requires your LAN ipv4 prefix. Use <code>ifconfig</code> command to find the prefix. <div class="fragment"><div class="line">Ifconfig</div></div><!-- fragment --> ex: if the inet address is 192.168.1.165 then 192.168.1.0 is your network prefix</li>
<li>Now use this command , which lists all the IP addresses Present in your Network. <div class="fragment"><div class="line">sudo nmap -sP 192.168.1.0/24</div><div class="line"></div><div class="line">   Nmap scan report for 192.168.1.249</div><div class="line">   Host is up (-0.100s latency).</div><div class="line">   MAC Address: 00:25:64:B7:0F:01 (Raspberry Pi foundation)</div></div><!-- fragment --></li>
<li>From the above output , Note the ipv4 address with the name Raspberry Pi foundation. Use the below command with username <code>root</code> and <code>empty password</code> to Log into Pi. <div class="fragment"><div class="line">ssh root@192.168.1.249</div></div><!-- fragment --> Inside the Raspbian , vim/nano editors are available. To change the settings, edit the <code>/etc/config/thread_border_router</code> file. The following lines can be found at the top of the file. <div class="fragment"><div class="line">vi /etc/config/thread_border_router</div><div class="line"></div><div class="line"># NCP Configuration</div><div class="line">ncp_interface=&quot;wpan0&quot;</div><div class="line">ncp_baudrate=&quot;115200&quot;</div><div class="line"># Thread Network Configuration</div><div class="line">thread_network_key=&quot;00112233445566778899AABBCCDDEEFF&quot;</div><div class="line">thread_channel=&quot;11&quot;</div><div class="line">thread_panid=&quot;0xABCD&quot;</div><div class="line"># IPv6 Addresses Configuration for NAT64</div><div class="line">prefix_nat48=&quot;fd00:0064:0123::&quot;</div><div class="line">prefix_nat64=&quot;fd00:0064:0123:4567::&quot;</div><div class="line">prefix_ula=&quot;fdff:cafe:cafe:cafe::&quot;</div><div class="line"># Commissioner Configuration</div><div class="line">nfc_commissioner_enable=true</div></div><!-- fragment --> <b>Note:</b> For the compatiability with Decawave dw1000 radio edit the channel to 5 and panid to 0xdeca.</li>
</ol>
<h2>Connectivity:</h2>
<p>NAT64 technology is enabled by default. It is used to enable communication between the IPv6-only Thread network with pure IPv4 LAN network that the Border Router connects to, as is the case in most applications. In that way, Thread nodes are able to connect to IPv4 cloud services. Thread devices will receive a NAT64-prefix and use it to create their own Unique Local Address.</p>
<p>The other connectivity option, which is also enabled by default, is support for the native IPv6 connection. It uses built-in DHCPv6 client on the Border Router which is able to receive prefixes from the Ethernet interface. If the received prefix is shorter than 63 bits, the 64-bit long subnet prefix is created and forwarded to the Thread network. In such situation, devices create one more address based on the forwarded prefix, which, unlike in a pure NAT64 solution, allows them to be reached from the Internet.</p>
<p><b>Note:</b> When dealing with native IPv6 connectivity, make sure you use the DHCPv6 service, and not the popular Stateless Address Autoconfiguration (SLAAC) tool. This autoconfig tool will only provide a 64-bit long prefix that is not sufficient to delegate a new 64-bit long prefix for the Thread network. Support for Domain Name System (DNS) resolution is also available. This mechanism is used to translate a host name into a corresponding IP address. It can be used either for translating a domain name into its native IPv6 or for obtaining its IPv4 address and returning IPv6 translated with the DNS64 mechanism.</p>
<h2>Testing:</h2>
<ol type="1">
<li>To test the Border Router, you can use another node with command line interface (CLI) and ping the Google DNS server 8.8.8.8.</li>
<li>Flash the CLI Binary onto another Nordic kit connected with EVB1000.</li>
<li>Start a terminal emulator like PuTTY/minicom/pyterm/ and connect to the used COM port with the settings described in CLI example</li>
<li>Run the following commands: <div class="fragment"><div class="line">panid 0xdeca</div><div class="line">channel 5</div><div class="line">ifconfig up</div><div class="line">thread start</div><div class="line">state</div><div class="line">ping fd00:0064:0123:4567::0808:0808</div></div><!-- fragment --> <b>Note:</b></li>
</ol>
<p>0808:0808 is in fact the Google DNS server address "8.8.8.8" in hex representation. In that way, you can reach any IPv4 cloud by replacing last 32 bits of an IPv6 address with a correctly encoded IPv4 address. After running the command, you should receive the following result: </p><div class="fragment"><div class="line">16 bytes from fd00:64:123:4567:0:0:808:808: icmp_seq=5 hlim=39 time=111ms</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 21 2017 18:58:05 for OT-DW1000 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
